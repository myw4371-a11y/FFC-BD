<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFC-BD Login</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="app-container">
        <div class="auth-box">
            <h1 class="logo-text">FFC-BD</h1>
            <p class="sub-text">লগইন করে খেলা শুরু করুন</p>

            <form id="loginForm">
                <div class="input-group">
                    <label>ইউজারনেম (Username)</label>
                    <input type="text" id="loginUser" placeholder="আপনার ইউজারনেম দিন" required>
                </div>

                <div class="input-group">
                    <label>পাসওয়ার্ড (Password)</label>
                    <input type="password" id="loginPass" placeholder="আপনার পাসওয়ার্ড দিন" required>
                </div>

                <button type="submit" class="btn-primary" id="loginBtn">লগইন করুন</button>
            </form>

            <p class="link-text">
                একাউন্ট নেই? <a href="register.html">রেজিস্ট্রেশন করুন</a>
            </p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBlljkD4UEqNGY2N5_zkEL_r9b50HVkwKA",
            authDomain: "ffc-bd.firebaseapp.com",
            projectId: "ffc-bd",
            storageBucket: "ffc-bd.firebasestorage.app",
            messagingSenderId: "533178061001",
            appId: "1:533178061001:web:37517e33f9594290d2bd18",
            measurementId: "G-NZN55GC3KX",
            databaseURL: "https://ffc-bd-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('loginBtn');
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value.trim();

            // ১. অ্যাডমিন চেক (অ্যাডমিন ইউজারনেম ও পাসওয়ার্ড)
            if (user === "admin" && pass === "ffcbd2025") {
                localStorage.setItem('userRole', 'admin');
                window.location.href = 'pages/admin.html';
                return;
            }

            btn.innerText = "অপেক্ষা করুন...";
            btn.disabled = true;

            // রেজিস্ট্রেশনের মতো একই লজিক: ইউজারনেম থেকে ইমেইল তৈরি
            const cleanUser = user.toLowerCase().replace(/\s/g, '');
            const fakeEmail = cleanUser + "@ffcbd.com";

            try {
                // ২. Firebase Auth দিয়ে লগইন
                const userCredential = await signInWithEmailAndPassword(auth, fakeEmail, pass);
                
                // তথ্য লোকাল স্টোরেজে রাখা
                localStorage.setItem('userRole', 'user');
                localStorage.setItem('username', user);
                localStorage.setItem('uid', userCredential.user.uid);

                alert("লগইন সফল হয়েছে!");
                window.location.href = 'pages/home.html';

            } catch (error) {
                console.error(error);
                btn.innerText = "লগইন করুন";
                btn.disabled = false;
                
                if (error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    alert("ভুল ইউজারনেম বা পাসওয়ার্ড!");
                } else {
                    alert("সমস্যা: " + error.message);
                }
            }
        });
    </script>
</body>
</html>
